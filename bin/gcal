#!/usr/bin/env python

"""
Command-line interface to Google Calendar's quick add feature.

Requires gdata package <http://pypi.python.org/pypi/gdata>
"""

import sys, webbrowser
from misc import password

from atom import Content
from gdata.calendar import CalendarEventEntry, QuickAdd, Reminder
from gdata.calendar.service import CalendarService

def quickadd(user, content, open_url=True):

    client = CalendarService(user, password('gmail', user),
                             'Google-Calendar_Python_Sample-1.0')
    client.ProgrammaticLogin()

    event = CalendarEventEntry()
    event.content = Content(text=content)
    event.quick_add = QuickAdd(value='true')

    remind = Reminder(days=1, method='email')
    #event.reminder = remind  -- doeesn't work

    # wait for google to parse and reply with a different event object
    new_event = client.InsertEvent(event, '/calendar/feeds/default/private/full')
#    new_event.when[0].reminder.append(remind)

#    client.InsertEvent(new_event, new_event.'/calendar/feeds/default/private/full')

#    new_event = client.UpdateEvent('/calendar/feeds/default/private/full', new_event)

#    from debug import ip; ip()

    #The reminder needs to be set under the when element:

    print 'created event: %r' % new_event.title.text
    if open_url:
        webbrowser.open(new_event.link[0].href)

if __name__ == '__main__':
    quickadd('timsfanmail', ' '.join(sys.argv[1:]))
