#!/usr/bin/env bash

# convert line number suffix if there is any...
args="$@"
args=$(python -c "import re; print re.sub('(.*?):(\d*:?\d*):?$', r'+\2 \1', '$args')")

function new-emacs {
    #echo "starting new emacs"
    emacs $args &
    disown $!
}

if [[ `ps aux |grep emacs |grep -v grep |grep emacs` ]]; then
    #echo "emacs already running; trying to use emacsclient"
    # fallback incase the emacs process isn't running a server
    if [[ `emacsclient -n $args 2>&1 >/dev/null &` ]]; then
        #echo "emacsclient failed; starting new emacs process."
        new-emacs
    fi
else
    new-emacs
fi


# TODO: looks like emacsclient give you a fallback... behavior isn't exactly the
# same. Can we simplify the stuff above?
#emacsclient -n -a emacs "$@" 2>/dev/null &
