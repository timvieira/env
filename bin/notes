#!/usr/bin/env bash

# TODO: search skid as well.
# TODO: don't just use filename. include the title (heuristic, first line=title)

function yellow { echo -e "\e[33m$@\e[0m"; }

COMP_NOTES=/home/timv/projects/notes/.index/files

matches=`cat $COMP_NOTES |/home/timv/projects/env/bin/filter.py $@`
retcode="$?"

echo "$matches"

if [[ "$retcode" -eq "0" ]]; then
    # feeling lucky, so we'll open the file for you.

    # drop color codes
    match=`echo "$matches" |pysed '\\033\[.*?m' '' `

    cd `dirname $match`

    # dispatch to the appropriate opener; the text editor is the default
    if [[ "$match" =~ .*\.(nb)$ ]]; then
        gnome-open $match
    elif [[ "$match" =~ .*\.(ipynb)$ ]]; then
        ipython notebook --pylab inline $match
    else
        $EDITOR "$match"
    fi

    bash   # sigh. Changing directory worked for bash function, but not for
           # this script version...

else
    yellow "pick a file or be more specific."

fi
